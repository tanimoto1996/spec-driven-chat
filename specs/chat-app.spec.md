# チャットアプリケーション仕様書

## 概要
リアルタイムでメッセージをやり取りできるシンプルなチャットアプリケーション

## 機能要件

### 1. ユーザー管理
- **FR-1.1**: ユーザーは名前を設定してチャットに参加できる
- **FR-1.2**: ユーザー名は1-20文字の範囲で設定可能
- **FR-1.3**: 同じユーザー名の重複は許可する

### 2. メッセージ送信
- **FR-2.1**: ユーザーはテキストメッセージを送信できる
- **FR-2.2**: メッセージは1-500文字の範囲で入力可能
- **FR-2.3**: 空のメッセージは送信できない
- **FR-2.4**: メッセージにはタイムスタンプが自動付与される

### 3. メッセージ受信
- **FR-3.1**: 他のユーザーが送信したメッセージをリアルタイムで受信できる
- **FR-3.2**: メッセージは送信者名、内容、タイムスタンプを含む
- **FR-3.3**: メッセージは時系列で表示される

### 4. 接続管理
- **FR-4.1**: ユーザーの入退室を他のユーザーに通知する
- **FR-4.2**: 現在のオンラインユーザー数を表示する

## 技術仕様

### データモデル

#### Message
```typescript
interface Message {
  id: string;           // メッセージID（UUID）
  username: string;     // 送信者名
  content: string;      // メッセージ内容
  timestamp: number;    // タイムスタンプ（Unix time）
}
```

#### User
```typescript
interface User {
  id: string;          // ユーザーID（Socket ID）
  username: string;    // ユーザー名
  joinedAt: number;    // 参加時刻
}
```

### WebSocket イベント

#### クライアント → サーバー
| イベント名 | パラメータ | 説明 |
|-----------|----------|------|
| `join` | `{ username: string }` | チャットルームに参加 |
| `sendMessage` | `{ content: string }` | メッセージ送信 |
| `disconnect` | - | 接続切断 |

#### サーバー → クライアント
| イベント名 | パラメータ | 説明 |
|-----------|----------|------|
| `message` | `Message` | 新しいメッセージ |
| `userJoined` | `{ username: string }` | ユーザー参加通知 |
| `userLeft` | `{ username: string }` | ユーザー退室通知 |
| `userCount` | `{ count: number }` | オンラインユーザー数 |
| `error` | `{ message: string }` | エラー通知 |

## UI仕様

### レイアウト
```
+----------------------------------+
|  チャットアプリ  [オンライン: X]  |
+----------------------------------+
|                                  |
|  [メッセージ表示エリア]           |
|                                  |
|  Username: Message               |
|  10:30                          |
|                                  |
+----------------------------------+
|  [メッセージ入力]      [送信]    |
+----------------------------------+
```

### カラースキーム
- プライマリカラー: #3b82f6（青）
- セカンダリカラー: #10b981（緑）
- 背景: #f3f4f6（薄灰色）
- テキスト: #1f2937（濃灰色）

## 非機能要件

### パフォーマンス
- **NFR-1**: メッセージ送信から受信まで1秒以内
- **NFR-2**: 100人の同時接続をサポート

### セキュリティ
- **NFR-3**: XSS攻撃を防ぐため、メッセージはエスケープ処理する
- **NFR-4**: メッセージ長の制限を実施

### 互換性
- **NFR-5**: Chrome、Firefox、Safari、Edgeの最新版をサポート
- **NFR-6**: モバイルブラウザでも利用可能

## テストシナリオ

### TC-1: 基本的なメッセージ送受信
1. ユーザーAがチャットに参加
2. ユーザーBがチャットに参加
3. ユーザーAがメッセージを送信
4. ユーザーBがメッセージを受信できることを確認

### TC-2: 複数ユーザーでの同時送信
1. 3人のユーザーが参加
2. 各ユーザーが同時にメッセージを送信
3. 全員が3つのメッセージを受信できることを確認

### TC-3: 入退室通知
1. ユーザーAが参加
2. ユーザーBが参加通知を受信
3. ユーザーAが退室
4. ユーザーBが退室通知を受信

## 今後の拡張予定

- プライベートメッセージ機能
- メッセージ履歴の永続化
- ファイル共有機能
- リアクション機能
- ユーザー認証
