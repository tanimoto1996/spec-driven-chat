name: ä»•æ§˜å¤‰æ›´æ¤œå‡º

on:
  pull_request:
    paths:
      - 'specs/**'

jobs:
  detect-spec-changes:
    name: ä»•æ§˜å¤‰æ›´ã®æ¤œå‡ºã¨å½±éŸ¿åˆ†æ
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: å¤‰æ›´ã•ã‚ŒãŸä»•æ§˜ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æ¤œå‡º
        id: changed-specs
        run: |
          echo "å¤‰æ›´ã•ã‚ŒãŸä»•æ§˜ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æ¤œå‡ºä¸­..."
          CHANGED_FILES=$(git diff --name-only origin/main...HEAD specs/)
          echo "$CHANGED_FILES"
          echo "changed_files<<EOF" >> $GITHUB_OUTPUT
          echo "$CHANGED_FILES" >> $GITHUB_OUTPUT
          echo "EOF" >> $GITHUB_OUTPUT

      - name: å½±éŸ¿ç¯„å›²ã®åˆ†æ
        run: |
          echo "## ä»•æ§˜å¤‰æ›´ã®å½±éŸ¿åˆ†æ ğŸ“‹" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "ä»¥ä¸‹ã®ä»•æ§˜ãƒ•ã‚¡ã‚¤ãƒ«ãŒå¤‰æ›´ã•ã‚Œã¾ã—ãŸ:" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "\`\`\`" >> $GITHUB_STEP_SUMMARY
          echo "${{ steps.changed-specs.outputs.changed_files }}" >> $GITHUB_STEP_SUMMARY
          echo "\`\`\`" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "### ç¢ºèªäº‹é … âœ…" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "- [ ] å‹å®šç¾©ã®æ›´æ–°ãŒå¿…è¦ã‹ç¢ºèª" >> $GITHUB_STEP_SUMMARY
          echo "- [ ] APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã®å¤‰æ›´ãŒå¿…è¦ã‹ç¢ºèª" >> $GITHUB_STEP_SUMMARY
          echo "- [ ] UIã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®å¤‰æ›´ãŒå¿…è¦ã‹ç¢ºèª" >> $GITHUB_STEP_SUMMARY
          echo "- [ ] ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ã®æ›´æ–°ãŒå¿…è¦ã‹ç¢ºèª" >> $GITHUB_STEP_SUMMARY
          echo "- [ ] ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®æ›´æ–°ãŒå¿…è¦ã‹ç¢ºèª" >> $GITHUB_STEP_SUMMARY

      - name: PR ã‚³ãƒ¡ãƒ³ãƒˆã‚’è¿½åŠ 
        uses: actions/github-script@v7
        with:
          script: |
            const comment = `## ğŸ” ä»•æ§˜å¤‰æ›´ãŒæ¤œå‡ºã•ã‚Œã¾ã—ãŸ

            ã“ã®PRã«ã¯ä»•æ§˜ãƒ•ã‚¡ã‚¤ãƒ«ã®å¤‰æ›´ãŒå«ã¾ã‚Œã¦ã„ã¾ã™ã€‚

            ### å¤‰æ›´ã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«
            \`\`\`
            ${{ steps.changed-specs.outputs.changed_files }}
            \`\`\`

            ### ãƒ¬ãƒ“ãƒ¥ãƒ¼æ™‚ã®ç¢ºèªäº‹é …
            - [ ] ä»•æ§˜å¤‰æ›´ã®å†…å®¹ãŒå¦¥å½“ã‹
            - [ ] å®Ÿè£…ã‚³ãƒ¼ãƒ‰ãŒä»•æ§˜ã«æº–æ‹ ã—ã¦ã„ã‚‹ã‹
            - [ ] ãƒ†ã‚¹ãƒˆãŒä»•æ§˜ã‚’ã‚«ãƒãƒ¼ã—ã¦ã„ã‚‹ã‹
            - [ ] å¾Œæ–¹äº’æ›æ€§ã¸ã®å½±éŸ¿ã¯ãªã„ã‹

            ### æ¨å¥¨ã‚¢ã‚¯ã‚·ãƒ§ãƒ³
            1. ä»•æ§˜æ›¸ã®å¤‰æ›´å†…å®¹ã‚’ç¢ºèª
            2. å½±éŸ¿ã‚’å—ã‘ã‚‹ã‚³ãƒ¼ãƒ‰ã‚’ç‰¹å®š
            3. å¿…è¦ãªå®Ÿè£…å¤‰æ›´ã‚’å®Ÿæ–½
            4. ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ã‚’æ›´æ–°

            ---
            *ã“ã®ã‚³ãƒ¡ãƒ³ãƒˆã¯è‡ªå‹•ç”Ÿæˆã•ã‚Œã¾ã—ãŸ*`;

            github.rest.issues.createComment({
              issue_number: context.issue.number,
              owner: context.repo.owner,
              repo: context.repo.repo,
              body: comment
            });
